<!DOCTYPE html>
<html lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="An interactive visual tutorial on lexing/parsing in compilers">
    <meta name="author" content="Akash Levy">
    <link rel="icon" href="assets/img/favicon.ico">
    <title>Vizpiler</title>
    <!-- Bootstrap core CSS -->
    <link rel='stylesheet' href='assets/css/bootstrap.min.css'>
    <!-- Codemirror core CSS and JS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.25.2/codemirror.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.25.2/codemirror.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.25.2/theme/dracula.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.25.2/mode/clike/clike.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.25.2/addon/selection/active-line.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.25.2/addon/edit/matchbrackets.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.25.2/addon/display/autorefresh.js"></script>
    <!-- Custom styles for this template -->
    <link rel='stylesheet' href='assets/css/main.css'>
  </head>
  <body>
    <div class='container'>
      <h1>Vizpiler</h1>
      <h2>An interactive visual tutorial on lexing/parsing in compilers</h2>
      <br>
      <div class="tabbox">
        <div class="tab">
          <button class="tablinks" onclick="openTab(event, 'LexerTheory')" id="defaultOpen">Lexer Theory</button>
          <button class="tablinks" onclick="openTab(event, 'LexerCode')">Lexer Code</button>
          <button class="tablinks" onclick="openTab(event, 'LexerVisual')">Lexer Visual</button>
          <button class="tablinks" onclick="openTab(event, 'ParserTheory')">Parser Theory</button>
          <button class="tablinks" onclick="openTab(event, 'ParserCode')">Parser Code</button>
          <button class="tablinks" onclick="openTab(event, 'ParserVisual')">Parser Visual</button>
          <button class="tablinks" onclick="openTab(event, 'ASTVisual')">AST Visual</button>
          <button class="tablinks" onclick="openTab(event, 'Interpreter')">Interpreter</button>
        </div>
        <div id="LexerCode" class="codecontent" style="overflow: scroll">
          <table style="width:100%">
            <tr>
              <td style="width:65%">
                <textarea id="lexercode">
%{
#include <stdlib.h>
#include "calc3.h"
#include "y.tab.h"
void yyerror(char *);
%}

%%

[a-z]       { 
                yylval.sIndex = *yytext - 'a';
                return VARIABLE;
            }

0           {
                yylval.iValue = atoi(yytext);
                return INTEGER;
            }

[1-9][0-9]* {
                yylval.iValue = atoi(yytext);
                return INTEGER;
            }

[-()<>=+*/;{}.] {
                return *yytext;
             }

">="            return GE;
"<="            return LE;
"=="            return EQ;
"!="            return NE;
"while"         return WHILE;
"if"            return IF;
"else"          return ELSE;
"print"         return PRINT;

[ \t\n]+        ;       /* ignore whitespace */

.               yyerror("Unknown character");

%%

int yywrap(void) {
    return 1;
}</textarea>
              </td>
              <td>
                <div id="LexerCompile" class="compilemsgcontent">
                  <button onclick="lexerCompile();" style="width:100%">Compile</button>
                  <br><br>
                  <div id="LexerMessages" style="overflow-y:scroll">
                  Enter the <i>flex</i> code you want to visualize and then compile it!
                  </div>
                </div>
              </td>
            </tr>
          </table>
        </div>
        <div id="ParserCode" class="codecontent" style="overflow: scroll">
          <textarea id="parsercode">
%{
#include <stdio.h>
#include <stdlib.h>
#include <stdarg.h>

typedef enum { typeCon, typeId, typeOpr } nodeEnum;

/* constants */
typedef struct {
    int value;                  /* value of constant */
} conNodeType;

/* identifiers */
typedef struct {
    int i;                      /* subscript to sym array */
} idNodeType;

/* operators */
typedef struct {
    int oper;                   /* operator */
    int nops;                   /* number of operands */
    struct nodeTypeTag *op[1];  /* operands, extended at runtime */
} oprNodeType;

typedef struct nodeTypeTag {
    nodeEnum type;              /* type of node */

    union {
        conNodeType con;        /* constants */
        idNodeType id;          /* identifiers */
        oprNodeType opr;        /* operators */
    };
} nodeType;

void yyerror(char *s);
int sym[26];                    /* symbol table */
%}

%union {
    int iValue;                 /* integer value */
    char sIndex;                /* symbol table index */
    nodeType *nPtr;             /* node pointer */
};

%token <iValue> INTEGER
%token <sIndex> VARIABLE
%token WHILE IF PRINT
%nonassoc IFX
%nonassoc ELSE

%left GE LE EQ NE '>' '<'
%left '+' '-'
%left '*' '/'
%nonassoc UMINUS

%type <nPtr> stmt expr stmt_list

%%

program:
        function                { exit(0); }
        ;

function:
          function stmt         { ex($2); freeNode($2); }
        | /* NULL */
        ;

stmt:
          ';'                            { $$ = opr(';', 2, NULL, NULL); }
        | expr ';'                       { $$ = $1; }
        | PRINT expr ';'                 { $$ = opr(PRINT, 1, $2); }
        | VARIABLE '=' expr ';'          { $$ = opr('=', 2, id($1), $3); }
        | WHILE '(' expr ')' stmt        { $$ = opr(WHILE, 2, $3, $5); }
        | IF '(' expr ')' stmt %prec IFX { $$ = opr(IF, 2, $3, $5); }
        | IF '(' expr ')' stmt ELSE stmt { $$ = opr(IF, 3, $3, $5, $7); }
        | '{' stmt_list '}'              { $$ = $2; }
        ;

stmt_list:
          stmt                  { $$ = $1; }
        | stmt_list stmt        { $$ = opr(';', 2, $1, $2); }
        ;

expr:
          INTEGER               { $$ = con($1); }
        | VARIABLE              { $$ = id($1); }
        | '-' expr %prec UMINUS { $$ = opr(UMINUS, 1, $2); }
        | expr '+' expr         { $$ = opr('+', 2, $1, $3); }
        | expr '-' expr         { $$ = opr('-', 2, $1, $3); }
        | expr '*' expr         { $$ = opr('*', 2, $1, $3); }
        | expr '/' expr         { $$ = opr('/', 2, $1, $3); }
        | expr '<' expr         { $$ = opr('<', 2, $1, $3); }
        | expr '>' expr         { $$ = opr('>', 2, $1, $3); }
        | expr GE expr          { $$ = opr(GE, 2, $1, $3); }
        | expr LE expr          { $$ = opr(LE, 2, $1, $3); }
        | expr NE expr          { $$ = opr(NE, 2, $1, $3); }
        | expr EQ expr          { $$ = opr(EQ, 2, $1, $3); }
        | '(' expr ')'          { $$ = $2; }
        ;

%%

nodeType *con(int value) {
    nodeType *p;

    /* allocate node */
    if ((p = malloc(sizeof(nodeType))) == NULL)
        yyerror("out of memory");

    /* copy information */
    p->type = typeCon;
    p->con.value = value;

    return p;
}

nodeType *id(int i) {
    nodeType *p;

    /* allocate node */
    if ((p = malloc(sizeof(nodeType))) == NULL)
        yyerror("out of memory");

    /* copy information */
    p->type = typeId;
    p->id.i = i;

    return p;
}

nodeType *opr(int oper, int nops, ...) {
    va_list ap;
    nodeType *p;
    int i;

    /* allocate node, extending op array */
    if ((p = malloc(sizeof(nodeType) + (nops-1) * sizeof(nodeType *))) == NULL)
        yyerror("out of memory");

    /* copy information */
    p->type = typeOpr;
    p->opr.oper = oper;
    p->opr.nops = nops;
    va_start(ap, nops);
    for (i = 0; i < nops; i++)
        p->opr.op[i] = va_arg(ap, nodeType*);
    va_end(ap);
    return p;
}

void freeNode(nodeType *p) {
    int i;

    if (!p) return;
    if (p->type == typeOpr) {
        for (i = 0; i < p->opr.nops; i++)
            freeNode(p->opr.op[i]);
    }
    free (p);
}

void yyerror(char *s) {
    fprintf(stdout, "%s\n", s);
}

int main(void) {
    yyparse();
    return 0;
}</textarea>
        </div>
        <div id="LexerVisual" class="tabcontent" style="padding: 5px 5px;">
          <div id="LexerVisualGraph" style="float: left; width: 65%; height: 100%; outline: #555555 dotted; overflow:hidden"></div>
          <div id="LexerInputCode" style="float: top; overflow: hidden; height: 50%; padding: 5px 10px; outline: #555555 dotted;">Input your test code here:
            <div style="display: block; padding-bottom: 30px; height: 100%"><textarea id="lexerinput">a = 5+120</textarea></div>
            <div style="top: 0; left: 0; height: 100%"></div>
          </div>
          <div style="word-wrap: break-word; word-wrap: break-all; float: top; overflow: scroll; height: 50%; padding: 10px 10px; outline: #555555 dotted;">
            <button id="startLexBut" onclick="startLexing();" style="width:33.33%; float:left;" disabled="true">Start Lexing</button>
            <button id="stepLexBut" onclick="stepLexer(true);" style="width:33.33%; float:left;" disabled="true">Step Forward</button>
            <button id="stepEndLexBut" onclick="stepEndLexer();" style="width:33.33%; float:top;" disabled="true">Step to End</button>
            <div id="lexingOutput"></div>
            <div id="lexingCodeOutput"></div>
          </div>
        </div>
        <div id="ParserVisual" class="tabcontent">
          <img style="height: 100%" src="https://www.gnu.org/software/bison/manual/html_node/figs/example.png"/>
        </div>
        <div id="ASTVisual" class="tabcontent">
          <img style="width: 100%" src="https://i.stack.imgur.com/AYA3S.png"/>
        </div>
        <div id="Interpreter" class="tabcontent">
          Code execution can be done here.
        </div>
        <div id="LexerTheory" class="tabcontent" style="padding: 0px 0px">
          <iframe src="assets/LexingTheory/index.html" style="width:100%; height:100%;" frameborder="0"></iframe>
        </div>
        <div id="ParserTheory" class="tabcontent" style="padding: 0px 0px">
          <iframe src="assets/ParsingTheory/index.html" style="width:100%; height:100%;" frameborder="0"></iframe>
        </div>
      </div>
    </div>
    <div class="footer navbar-fixed-bottom">
    <script src='assets/js/vanilla.js'></script>
    <script src='assets/js/jquery-3.2.1.min.js'></script>
    <script src='assets/js/tether.min.js'></script>
    <script src='assets/js/bootstrap.min.js'></script>
    <script src="assets/js/graphlib-dot.min.js"></script>
    <script src="assets/js/viz.js"></script>
    <script src="assets/js/svg-pan-zoom.min.js"></script>
    <script src='assets/js/require.js' data-main="assets/js/main"></script>
  </body>
</html>
