<!DOCTYPE html>
<html lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="An interactive visual tutorial on lexing/parsing in compilers">
    <meta name="author" content="Akash Levy">
    <link rel="icon" href="assets/img/favicon.ico">
    <title>Vizpiler</title>
    <!-- Bootstrap core CSS -->
    <link rel='stylesheet' href='assets/css/bootstrap.min.css'>
    <!-- Codemirror core CSS and JS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.25.2/codemirror.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.25.2/codemirror.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.25.2/theme/dracula.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.25.2/mode/clike/clike.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.25.2/addon/selection/active-line.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.25.2/addon/edit/matchbrackets.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.25.2/addon/display/autorefresh.js"></script>
    <!-- Custom styles for this template -->
    <link rel='stylesheet' href='assets/css/main.css'>
  </head>
  <body>
    <div class='container'>
      <h1>Vizpiler</h1>
      <h2>An interactive visual tutorial on lexing/parsing in compilers</h2>
      <br>
      <div class="tabbox">
        <div class="tab">
          <button class="tablinks" onclick="openTab(event, 'Lexer Theory')" id="defaultOpen">Lexer Theory</button>
          <button class="tablinks" onclick="openTab(event, 'Lexer Code')">Lexer Code</button>
          <button class="tablinks" onclick="openTab(event, 'Lexer Visual')">Lexer Visual</button>
          <button class="tablinks" onclick="openTab(event, 'Parser Theory')">Parser Theory</button>
          <button class="tablinks" onclick="openTab(event, 'Parser Code')">Parser Code</button>
          <button class="tablinks" onclick="openTab(event, 'Parser Visual')">Parser Visual</button>
          <button class="tablinks" onclick="openTab(event, 'AST Visual')">AST Visual</button>
          <button class="tablinks" onclick="openTab(event, 'Interpreter')">Interpreter</button>
        </div>
        <div id="Lexer Code" class="codecontent">
          <textarea id="lexercode">
%{
#include <stdlib.h>
#include "calc3.h"
#include "y.tab.h"
void yyerror(char *);
%}

%%

[a-z]       { 
                yylval.sIndex = *yytext - 'a';
                return VARIABLE;
            }

0           {
                yylval.iValue = atoi(yytext);
                return INTEGER;
            }

[1-9][0-9]* {
                yylval.iValue = atoi(yytext);
                return INTEGER;
            }

[-()<>=+*/;{}.] {
                return *yytext;
             }

">="            return GE;
"<="            return LE;
"=="            return EQ;
"!="            return NE;
"while"         return WHILE;
"if"            return IF;
"else"          return ELSE;
"print"         return PRINT;

[ \t\n]+        ;       /* ignore whitespace */

.               yyerror("Unknown character");

%%

int yywrap(void) {
    return 1;
}</textarea>
        </div>
        <div id="Parser Code" class="codecontent">
          <textarea id="parsercode">
%{
#include <stdio.h>
#include <stdlib.h>
#include <stdarg.h>

typedef enum { typeCon, typeId, typeOpr } nodeEnum;

/* constants */
typedef struct {
    int value;                  /* value of constant */
} conNodeType;

/* identifiers */
typedef struct {
    int i;                      /* subscript to sym array */
} idNodeType;

/* operators */
typedef struct {
    int oper;                   /* operator */
    int nops;                   /* number of operands */
    struct nodeTypeTag *op[1];  /* operands, extended at runtime */
} oprNodeType;

typedef struct nodeTypeTag {
    nodeEnum type;              /* type of node */

    union {
        conNodeType con;        /* constants */
        idNodeType id;          /* identifiers */
        oprNodeType opr;        /* operators */
    };
} nodeType;

void yyerror(char *s);
int sym[26];                    /* symbol table */
%}

%union {
    int iValue;                 /* integer value */
    char sIndex;                /* symbol table index */
    nodeType *nPtr;             /* node pointer */
};

%token <iValue> INTEGER
%token <sIndex> VARIABLE
%token WHILE IF PRINT
%nonassoc IFX
%nonassoc ELSE

%left GE LE EQ NE '>' '<'
%left '+' '-'
%left '*' '/'
%nonassoc UMINUS

%type <nPtr> stmt expr stmt_list

%%

program:
        function                { exit(0); }
        ;

function:
          function stmt         { ex($2); freeNode($2); }
        | /* NULL */
        ;

stmt:
          ';'                            { $$ = opr(';', 2, NULL, NULL); }
        | expr ';'                       { $$ = $1; }
        | PRINT expr ';'                 { $$ = opr(PRINT, 1, $2); }
        | VARIABLE '=' expr ';'          { $$ = opr('=', 2, id($1), $3); }
        | WHILE '(' expr ')' stmt        { $$ = opr(WHILE, 2, $3, $5); }
        | IF '(' expr ')' stmt %prec IFX { $$ = opr(IF, 2, $3, $5); }
        | IF '(' expr ')' stmt ELSE stmt { $$ = opr(IF, 3, $3, $5, $7); }
        | '{' stmt_list '}'              { $$ = $2; }
        ;

stmt_list:
          stmt                  { $$ = $1; }
        | stmt_list stmt        { $$ = opr(';', 2, $1, $2); }
        ;

expr:
          INTEGER               { $$ = con($1); }
        | VARIABLE              { $$ = id($1); }
        | '-' expr %prec UMINUS { $$ = opr(UMINUS, 1, $2); }
        | expr '+' expr         { $$ = opr('+', 2, $1, $3); }
        | expr '-' expr         { $$ = opr('-', 2, $1, $3); }
        | expr '*' expr         { $$ = opr('*', 2, $1, $3); }
        | expr '/' expr         { $$ = opr('/', 2, $1, $3); }
        | expr '<' expr         { $$ = opr('<', 2, $1, $3); }
        | expr '>' expr         { $$ = opr('>', 2, $1, $3); }
        | expr GE expr          { $$ = opr(GE, 2, $1, $3); }
        | expr LE expr          { $$ = opr(LE, 2, $1, $3); }
        | expr NE expr          { $$ = opr(NE, 2, $1, $3); }
        | expr EQ expr          { $$ = opr(EQ, 2, $1, $3); }
        | '(' expr ')'          { $$ = $2; }
        ;

%%

nodeType *con(int value) {
    nodeType *p;

    /* allocate node */
    if ((p = malloc(sizeof(nodeType))) == NULL)
        yyerror("out of memory");

    /* copy information */
    p->type = typeCon;
    p->con.value = value;

    return p;
}

nodeType *id(int i) {
    nodeType *p;

    /* allocate node */
    if ((p = malloc(sizeof(nodeType))) == NULL)
        yyerror("out of memory");

    /* copy information */
    p->type = typeId;
    p->id.i = i;

    return p;
}

nodeType *opr(int oper, int nops, ...) {
    va_list ap;
    nodeType *p;
    int i;

    /* allocate node, extending op array */
    if ((p = malloc(sizeof(nodeType) + (nops-1) * sizeof(nodeType *))) == NULL)
        yyerror("out of memory");

    /* copy information */
    p->type = typeOpr;
    p->opr.oper = oper;
    p->opr.nops = nops;
    va_start(ap, nops);
    for (i = 0; i < nops; i++)
        p->opr.op[i] = va_arg(ap, nodeType*);
    va_end(ap);
    return p;
}

void freeNode(nodeType *p) {
    int i;

    if (!p) return;
    if (p->type == typeOpr) {
        for (i = 0; i < p->opr.nops; i++)
            freeNode(p->opr.op[i]);
    }
    free (p);
}

void yyerror(char *s) {
    fprintf(stdout, "%s\n", s);
}

int main(void) {
    yyparse();
    return 0;
}</textarea>
        </div>
        <div id="Lexer Visual" class="tabcontent" style="text-align: center">
          <img style="height: 100%" src="https://www.genivia.com/images/reflex-json-string.png"/>
        </div>
        <div id="Parser Visual" class="tabcontent" style="text-align: center">
          <img style="height: 100%" src="https://www.gnu.org/software/bison/manual/html_node/figs/example.png"/>
        </div>
        <div id="AST Visual" class="tabcontent">
          <img style="width: 100%" src="https://i.stack.imgur.com/AYA3S.png"/>
        </div>
        <div id="Interpreter" class="tabcontent">
          Code execution can be done here.
        </div>
        <div id="Lexer Theory" class="tabcontent">
          <h3>Lexer Theory</h3>
          <p>Topics: How regexes work, how they are combined, how to build them, yacc</p>
        </div>
        <div id="Parser Theory" class="tabcontent">
          <h3>Parser Theory</h3>
          <p>Topics: What different kinds of parsers exist, parsing algorithms, CFG, yacc</p>
        </div>
      </div>
    </div>
    <div class="footer navbar-fixed-bottom">
    <script src='assets/js/vanilla.js'></script>
    <script src='assets/js/jquery-3.1.1.slim.min.js'></script>
    <script src='assets/js/tether.min.js'></script>
    <script src='assets/js/bootstrap.min.js'></script>
  </body>
  <script>
    var lexereditor = CodeMirror.fromTextArea(lexercode,
    {
      lineNumbers: true,
      styleActiveLine: true,
      matchBrackets: true,
      mode: "text/x-c++src",
      theme: "dracula"
    });
    var parsereditor = CodeMirror.fromTextArea(parsercode,
    {
      lineNumbers: true,
      styleActiveLine: true,
      matchBrackets: true,
      mode: "text/x-c++src",
      theme: "dracula"
    });

    function openTab(evt, tabName) {
        var i, tabcontent, tablinks;
        tabcontent = document.getElementsByClassName("tabcontent");
        for (i = 0; i < tabcontent.length; i++) {
            tabcontent[i].style.display = "none";
        }
        tabcontent = document.getElementsByClassName("codecontent");
        for (i = 0; i < tabcontent.length; i++) {
            tabcontent[i].style.display = "none";
        }
        tablinks = document.getElementsByClassName("tablinks");
        for (i = 0; i < tablinks.length; i++) {
            tablinks[i].className = tablinks[i].className.replace(" active", "");
        }
        document.getElementById(tabName).style.display = "block";
        evt.currentTarget.className += " active";

        lexereditor.refresh();
        parsereditor.refresh();
    }

    // Get the element with id="defaultOpen" and click on it
    document.getElementById("defaultOpen").click();

  </script>
</html>
